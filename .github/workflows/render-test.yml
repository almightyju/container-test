name: Render Test

on:
    workflow_dispatch:
        inputs:
            jsreport_hostname:
                description: 'The hostname/ip that points to where jsreport is running'
                default: 'localhost'
                required: false
                type: string
            
            http_server_hostname:
                description: 'The hostname/ip that points to the web server that hosts the css file'
                default: 'localhost'
                required: false
                type: string


jobs:
    test:
        runs-on: ubuntu-latest
        services:
            jsreport:
                image: jsreport/jsreport:4.5.0-full
                ports:
                    - 5488:5488
                env:
                    extensions_chromePdf_launchOptions_args: --no-sandbox
        steps:
            - name: apt install
              run: sudo apt-get update && sudo apt-get install cabextract
            - name: install font
              run: wget https://gist.githubusercontent.com/maxwelleite/913b6775e4e408daa904566eb375b090/raw/ttf-ms-tahoma-installer.sh -q -O - | sudo bash

            - name: Set System locale
              run: |
                sudo locale-gen en_GB.UTF-8
                sudo update-locale LANG=en_GB.UTF-8

            - name: install stuff
              run: sudo apt-get update && sudo apt-get install -y ghostscript libfontconfig1

            - name: check pwsh
              shell: pwsh
              run: Get-Location

            - uses: actions/checkout@v4
            - uses: actions/setup-node@v4
              with:
                node-version: 'lts/*'

            - name: sleep
              run: sleep 10s

            - name: exec
              env:
                JSREPORT_HOSTNAME: ${{ inputs.jsreport_hostname }}
                HTTP_SERVER_HOSTNAME: ${{ inputs.http_server_hostname }}
              run: node ./exec.mjs
            
            - name: Save result
              uses: actions/upload-artifact@v3
              with:
                name: result.pdf
                path: result.pdf
                retention-days: 5